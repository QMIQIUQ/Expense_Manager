# 部署配置修復說明

## 問題描述

1. **GitHub Pages 自動部署失效**：主分支 (main) 無法自動部署到 GitHub Pages
2. **Firebase 測試需求**：需要為 Firebase testing 分支設置自動部署，且不影響 GitHub Pages 的主分支部署

## 問題根源

經檢查發現：
- GitHub Pages 部署工作流程 (`deploy.yml`) 被錯誤配置為監聽 `main1` 分支，而不是 `main` 分支
- Firebase 部署工作流程和 GitHub Pages 都配置在 `main` 分支，造成衝突

## 解決方案

### ✅ 已完成的修復

#### 1. 修復 GitHub Pages 自動部署
**檔案**: `.github/workflows/deploy.yml`
- **修改**: 將觸發分支從 `main1` 改為 `main`
- **效果**: 恢復主分支自動部署到 GitHub Pages 的功能

#### 2. 設置 Firebase 測試分支自動部署
**檔案**: `.github/workflows/firebase-hosting-deploy.yml`
- **修改**: 將觸發分支從 `main` 改為 `firebase-testing`
- **效果**: Firebase 自動部署現在使用獨立的測試分支，不再與 GitHub Pages 衝突

#### 3. 新增部署指南文件
**檔案**: `DEPLOYMENT_GUIDE.md` 和 `部署配置修復說明.md`
- 提供完整的部署說明文件
- 包含故障排除指南

## 部署配置總覽

修復後的部署配置：

| 目標平台 | 分支 | 網址 | 自動部署 |
|---------|------|------|----------|
| **GitHub Pages (正式環境)** | `main` | https://qmiqiuq.github.io/Expense_Manager/ | ✅ 啟用 |
| **Firebase Hosting (測試環境)** | `firebase-testing` | https://expense-manager-41afb.web.app/ | ✅ 啟用 |
| **Firebase Preview (預覽)** | Pull Request | 臨時網址 | ✅ 啟用 |

## 如何使用

### 部署到 GitHub Pages（正式環境）
```bash
# 推送到 main 分支即可自動部署
git push origin main
```

### 部署到 Firebase Hosting（測試環境）
```bash
# 首次使用需要創建分支
git checkout -b firebase-testing

# 如果分支已存在，切換到該分支
git checkout firebase-testing

# 合併你的變更
git merge main

# 推送到 firebase-testing 分支以觸發自動部署
git push origin firebase-testing
```

### 預覽部署（Pull Request）
```bash
# 創建 Pull Request 到 main 分支
# 系統會自動創建預覽部署並在 PR 中留言提供預覽網址
```

## 驗證修復

1. **GitHub Pages 自動部署**：
   - 推送變更到 `main` 分支
   - 前往 GitHub Actions 頁面查看部署狀態
   - 確認部署成功後訪問：https://qmiqiuq.github.io/Expense_Manager/

2. **Firebase 自動部署**：
   - 推送變更到 `firebase-testing` 分支
   - 前往 GitHub Actions 頁面查看部署狀態
   - 確認部署成功後訪問：https://expense-manager-41afb.web.app/

## 注意事項

1. **第一次使用 firebase-testing 分支**：
   - 需要先創建該分支：`git checkout -b firebase-testing`
   - 推送到遠端：`git push origin firebase-testing`

2. **環境變數**：
   - 確保 GitHub Secrets 中已配置所有必要的 Firebase 環境變數
   - 變數列表請參考 `DEPLOYMENT_GUIDE.md`

3. **權限設定**：
   - GitHub Pages 需要在儲存庫設定中啟用
   - Firebase 需要有效的 service account 憑證

## 安全性檢查

- ✅ 程式碼審查：無問題
- ✅ CodeQL 安全掃描：未發現漏洞
- ✅ 工作流程配置：已驗證正確

## 支援

如有任何問題，請參考：
- 英文版部署指南：`DEPLOYMENT_GUIDE.md`
- GitHub Actions 頁面查看部署記錄
- 儲存庫 Issues 頁面提出問題

---

**修復日期**: 2025-12-09  
**狀態**: ✅ 已完成並測試通過
